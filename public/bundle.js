!function(){"use strict";const e=[s(460551),s(2033415),s(3084039),s(4656903),s(5707527),s(6758151),s(7806727),s(9381639),s(10432263),s(11484935),s(12535559),s(13059847),s(14634759),s(14636807),s(14636807),s(14114567),s(14116623),s(13594383),s(13596431),s(13598479),s(13600535),s(13076247),s(13078295),s(13080351),s(12558111),s(12558111),s(12560167),s(12560167),s(12562223),s(12037935),s(12039983),s(12039991),s(13619055),s(14671775),s(15724487),s(16777215)];class t{constructor(e,t){this.canvas=t,this.parent=e,this.flames=[],this.width=320,this.height=168,this.ctx=t.getContext("2d"),this.imageData=this.ctx.getImageData(0,0,this.width,this.height),this._init(),this.lastUpdate=0,this.active=!0,this.wind=0}posAt(e,t){return t*this.width+e}setValue(e,t,s){let i=this.posAt(e,t);this.flames[i]=s}valueAt(e,t){let s=this.posAt(e,t);return this.flames[s]}_init(){this._initCanvas(),this._initFlames()}_initFlames(){for(let e=0;e<this.width;e++)for(let t=1;t<this.height;t++)this.setValue(e,t,0);for(let e=0;e<this.width;e++)this.setValue(e,this.height-1,35)}_initCanvas(){for(let e=0;e<this.imageData.data.length;e++)this.imageData.data[e]=0,e%4==3&&(this.imageData.data[e]=255)}start(){requestAnimationFrame(this._update.bind(this))}_update(){let t=performance.now();if(t-this.lastUpdate<37.03703703703704)this.parent.requestAnimationFrame(this._update.bind(this));else{for(let t=0;t<this.height;t++){const s=t*this.width,i=(t-1)*this.width;for(let a=0;a<this.width;a++){const n=s+a,o=this.flames[n];if(t>0){const e=Math.floor(3*Math.random()),t=o>0?o-(1&e):0;let s=a+e-1+this.wind;s>=this.width?s-=this.width:s<0&&(s+=this.width);const n=i+s;this.flames[n]=t}const r=4*(s+a);if(o>0){const t=e[o];this.imageData.data[r]=t.r,this.imageData.data[r+1]=t.g,this.imageData.data[r+2]=t.b,this.imageData.data[r+3]=255}else this.imageData.data[r]=0,this.imageData.data[r+1]=0,this.imageData.data[r+2]=0,this.imageData.data[r+3]=255}}this.ctx.putImageData(this.imageData,0,0),this.lastUpdate=t,this.parent.requestAnimationFrame(this._update.bind(this))}}toggle(){if(this.active)for(let e=0;e<this.width;e++)this.setValue(e,this.height-1,0);else for(let e=0;e<this.width;e++)this.setValue(e,this.height-1,35);this.active=!this.active}setWind(e){this.wind=e}}function s(e){return{r:e>>16&255,g:e>>8&255,b:255&e}}class i extends HTMLElement{constructor(){if(super(),this.active=!0,this.canvas=document.createElement("canvas"),this.offscreen="OffscreenCanvas"in window,this.canvas.width=320,this.canvas.height=168,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.imageRendering="pixelated",this.offscreen){console.log("Rendering with Offscreen Canvas.");const e=this.canvas.transferControlToOffscreen();e.width=320,e.height=168,this.worker=new Worker("doom-fire-worker.js"),this.worker.postMessage({msg:"init",canvas:e},[e])}else console.log("Rendering with regular Canvas."),this.animation=new t(window,this.canvas);this.attachShadow({mode:"open"}).appendChild(this.canvas),this.addEventListener("click",(()=>{this.toggle()}))}connectedCallback(){this.offscreen?this.worker.postMessage({msg:"start"}):this.animation.start()}toggle(){this.offscreen?this.worker.postMessage({msg:"toggle"}):this.animation.toggle()}setWind(e){this.offscreen?this.worker.postMessage({msg:"wind",amount:e}):this.animation.setWind(e)}}customElements.get("doom-fire")||customElements.define("doom-fire",i);class a{constructor(e){this.wakeLock=null,this.keepAwakeButton=e}async requestWakeLock(){try{this.wakeLock=await navigator.wakeLock.request("screen"),this.wakeLock.addEventListener("release",(()=>{this.keepAwakeButton.checked=!1,console.log("Screen Wake Lock was released.")}),{once:!0}),console.log("Screen Wake Lock is active."),this.keepAwakeButton.checked=!0}catch(e){console.error(`${e.name}, ${e.message}`)}}async releaseWakeLock(){try{this.wakeLock.release(),this.wakeLock=null}catch(e){console.error(`${e.name}, ${e.message}`)}}static setup(e){if(!1 in navigator)return void console.log("Wake Lock API is not supported ðŸ˜ž");console.log("Wake Lock API supported ðŸŽ‰"),e.removeAttribute("disabled"),e.classList.remove("hidden");const t=new a(e);e.addEventListener("click",(async()=>{t.wakeLock?await t.releaseWakeLock():await t.requestWakeLock()}));document.addEventListener("visibilitychange",(()=>{null!==t.wakeLock&&"visible"===document.visibilityState&&t.requestWakeLock()}))}}const n="isTrustedWebActivity";let o;"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/sw.js")}));let r=0;const c=document.querySelector("#audio"),h=document.querySelector("#fullscreen");(class{static setup(e,t){t.requestFullscreen?(console.log("Fullscreen API supported ðŸŽ‰"),e.classList.remove("hidden"),e.addEventListener("click",(async()=>{try{document.fullscreenElement?(console.log("Exiting fullscreen."),await document.exitFullscreen()):(console.log("Entering fullscreen."),await t.requestFullscreen())}catch(e){console.error(`${e.name}, ${e.message}`)}})),t.addEventListener("fullscreenchange",(t=>{document.fullscreenElement?e.checked=!0:e.checked=!1}))):console.log("Fullscreen API is not supported ðŸ˜ž")}}).setup(h,document.body);const l=document.querySelector("#keep-awake");a.setup(l);const d=document.querySelector("#sound");d.addEventListener("click",(()=>{d.checked?(console.log("pause"),c.pause()):(console.log("play"),c.play())}));const u=document.querySelector("#install");let m;(function(e){if("true"===sessionStorage.getItem(n))return!0;const t=document.referrer.trim();if(0===t.length)return!1;console.log("Referrer: ",t);const s=new URL(t);return"android-app:"===s.protocol&&s.hostname===e&&(sessionStorage.setItem(n,"true"),!0)})("com.doom_fire.twa")&&(console.log("Running in Trusted Web Activity Mode!"),h.classList.add("hidden")),document.addEventListener("keydown",(e=>{o&&("ArrowLeft"===e.key?(r--,o.setWind(r)):"ArrowRight"==e.key&&(r++,o.setWind(r)))})),window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",(e=>{switch((screen.orientation||{}).type||screen.mozOrientation||screen.msOrientation){case"portrait-primary":r=-Math.round(e.gamma/10);break;case"portrait-secondary":r=Math.round(e.gamma/10);break;case"landscape-primary":r=-Math.round(e.beta/10);break;case"landscape-secondary":r=Math.round(e.beta/10)}o.setWind(r)})),window.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),m=e,u.classList.remove("hidden"),console.log("'beforeinstallprompt' event was fired.")})),u.addEventListener("click",(async()=>{if(m){m.prompt();const{outcome:e}=await m.userChoice;console.log(`User response to the install prompt: ${e}`)}})),customElements.whenDefined("doom-fire").then((()=>{o=document.querySelector("doom-fire")}))}();
//# sourceMappingURL=bundle.js.map
