!function(){"use strict";const e=[i(460551),i(2033415),i(3084039),i(4656903),i(5707527),i(6758151),i(7806727),i(9381639),i(10432263),i(11484935),i(12535559),i(13059847),i(14634759),i(14636807),i(14636807),i(14114567),i(14116623),i(13594383),i(13596431),i(13598479),i(13600535),i(13076247),i(13078295),i(13080351),i(12558111),i(12558111),i(12560167),i(12560167),i(12562223),i(12037935),i(12039983),i(12039991),i(13619055),i(14671775),i(15724487),i(16777215)],t=1e3/27;class s{constructor(e,t){this.canvas=t,this.parent=e,this.flames=[],this.width=320,this.height=168,this.ctx=t.getContext("2d"),this.imageData=this.ctx.getImageData(0,0,this.width,this.height),this._init(),this.lastUpdate=0,this.active=!0,this.wind=0}posAt(e,t){return t*this.width+e}setValue(e,t,s){let i=this.posAt(e,t);this.flames[i]=s}valueAt(e,t){let s=this.posAt(e,t);return this.flames[s]}_init(){this._initCanvas(),this._initFlames()}_initFlames(){for(let e=0;e<this.width;e++)for(let t=1;t<this.height;t++)this.setValue(e,t,0);for(let e=0;e<this.width;e++)this.setValue(e,this.height-1,35)}_initCanvas(){for(let e=0;e<this.imageData.data.length;e++)this.imageData.data[e]=0,e%4==3&&(this.imageData.data[e]=255)}start(){requestAnimationFrame(this._update.bind(this))}_update(){let s=performance.now();if(s-this.lastUpdate<t)this.parent.requestAnimationFrame(this._update.bind(this));else{for(let t=0;t<this.height;t++){const s=t*this.width,i=(t-1)*this.width;for(let a=0;a<this.width;a++){const n=s+a,o=this.flames[n];if(t>0){const e=Math.floor(3*Math.random()),t=o>0?o-(1&e):0;let s=a+e-1+this.wind;s>=this.width?s-=this.width:s<0&&(s+=this.width);const n=i+s;this.flames[n]=t}const r=4*(s+a);if(o>0){const t=e[o];this.imageData.data[r]=t.r,this.imageData.data[r+1]=t.g,this.imageData.data[r+2]=t.b,this.imageData.data[r+3]=255}else this.imageData.data[r]=0,this.imageData.data[r+1]=0,this.imageData.data[r+2]=0,this.imageData.data[r+3]=255}}this.ctx.putImageData(this.imageData,0,0),this.lastUpdate=s,this.parent.requestAnimationFrame(this._update.bind(this))}}toggle(){if(this.active)for(let e=0;e<this.width;e++)this.setValue(e,this.height-1,0);else for(let e=0;e<this.width;e++)this.setValue(e,this.height-1,35);this.active=!this.active}setWind(e){this.wind=e}}function i(e){return{r:e>>16&255,g:e>>8&255,b:255&e}}class a extends HTMLElement{constructor(){if(super(),this.active=!0,this.canvas=document.createElement("canvas"),this.offscreen=!1,this.canvas.width=320,this.canvas.height=168,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.imageRendering="pixelated",this.offscreen){console.log("Rendering with Offscreen Canvas.");const e=this.canvas.transferControlToOffscreen();e.width=320,e.height=168,this.worker=new Worker("doom-fire-worker.js"),this.worker.postMessage({msg:"init",canvas:e},[e])}else console.log("Rendering with regular Canvas."),this.animation=new s(window,this.canvas);this.attachShadow({mode:"open"}).appendChild(this.canvas),this.addEventListener("click",()=>{this.toggle()})}connectedCallback(){this.offscreen?this.worker.postMessage({msg:"start"}):this.animation.start()}toggle(){this.offscreen?this.worker.postMessage({msg:"toggle"}):this.animation.toggle()}setWind(e){this.offscreen?this.worker.postMessage({msg:"wind",amount:e}):this.animation.setWind(e)}}customElements.get("doom-fire")||customElements.define("doom-fire",a);class n{constructor(e){this.wakeLock=null,this.keepAwakeButton=e}async requestWakeLock(){try{this.wakeLock=await navigator.wakeLock.request("screen"),this.wakeLock.addEventListener("release",()=>{this.keepAwakeButton.checked=!1,console.log("Screen Wake Lock was released.")},{once:!0}),console.log("Screen Wake Lock is active."),this.keepAwakeButton.checked=!0}catch(e){console.error(`${e.name}, ${e.message}`)}}async releaseWakeLock(){try{this.wakeLock.release(),this.wakeLock=null}catch(e){console.error(`${e.name}, ${e.message}`)}}static setup(e){if(!1 in navigator)return void console.log("Wake Lock API is not supported ðŸ˜ž");console.log("Wake Lock API supported ðŸŽ‰"),e.removeAttribute("disabled"),e.classList.remove("hidden");const t=new n(e);e.addEventListener("click",async()=>{t.wakeLock?await t.releaseWakeLock():await t.requestWakeLock()});document.addEventListener("visibilitychange",()=>{null!==t.wakeLock&&"visible"===document.visibilityState&&t.requestWakeLock()})}}const o="android-app:",r="isTrustedWebActivity";let c;"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js")});let h=0;const l=document.querySelector("#audio"),d=document.querySelector("#fullscreen");(class{static setup(e,t){t.requestFullscreen?(console.log("Fullscreen API supported ðŸŽ‰"),e.classList.remove("hidden"),e.addEventListener("click",async()=>{try{document.fullscreenElement?(console.log("Exiting fullscreen."),await document.exitFullscreen()):(console.log("Entering fullscreen."),await t.requestFullscreen())}catch(e){console.error(`${e.name}, ${e.message}`)}}),t.addEventListener("fullscreenchange",t=>{document.fullscreenElement?e.checked=!0:e.checked=!1})):console.log("Fullscreen API is not supported ðŸ˜ž")}}).setup(d,document.body);const u=document.querySelector("#keep-awake");n.setup(u);const m=document.querySelector("#sound");m.addEventListener("click",()=>{m.checked?(console.log("pause"),l.pause()):(console.log("play"),l.play())}),function(e){if("true"===sessionStorage.getItem(r))return!0;const t=document.referrer.trim();if(0===t.length)return!1;console.log("Referrer: ",t);const s=new URL(t);return s.protocol===o&&s.hostname===e&&(sessionStorage.setItem(r,"true"),!0)}("com.doom_fire.twa")&&(console.log("Running in Trusted Web Activity Mode!"),d.classList.add("hidden")),document.addEventListener("keydown",e=>{c&&("ArrowLeft"===e.key?(h--,c.setWind(h)):"ArrowRight"==e.key&&(h++,c.setWind(h)))}),window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",e=>{switch((screen.orientation||{}).type||screen.mozOrientation||screen.msOrientation){case"portrait-primary":h=-Math.round(e.gamma/10);break;case"portrait-secondary":h=Math.round(e.gamma/10);break;case"landscape-primary":h=-Math.round(e.beta/10);break;case"landscape-secondary":h=Math.round(e.beta/10)}c.setWind(h)}),customElements.whenDefined("doom-fire").then(()=>{c=document.querySelector("doom-fire")})}();
//# sourceMappingURL=bundle.js.map
