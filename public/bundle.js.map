{"version":3,"file":"bundle.js","sources":["../src/doom-fire.mjs"],"sourcesContent":["const HTML_COLOR_SCALE = [\n  parseColor(0x070707), parseColor(0x1f0707), parseColor(0x2f0f07),\n  parseColor(0x470f07), parseColor(0x571707), parseColor(0x671f07),\n  parseColor(0x771f07), parseColor(0x8f2707), parseColor(0x9f2f07),\n  parseColor(0xaf3f07), parseColor(0xbf4707), parseColor(0xc74707),\n  parseColor(0xDF4F07), parseColor(0xDF5707), parseColor(0xDF5707),\n  parseColor(0xD75F07), parseColor(0xD7670F), parseColor(0xcf6f0f),\n  parseColor(0xcf770f), parseColor(0xcf7f0f), parseColor(0xCF8717),\n  parseColor(0xC78717), parseColor(0xC78F17), parseColor(0xC7971F),\n  parseColor(0xBF9F1F), parseColor(0xBF9F1F), parseColor(0xBFA727),\n  parseColor(0xBFA727), parseColor(0xBFAF2F), parseColor(0xB7AF2F),\n  parseColor(0xB7B72F), parseColor(0xB7B737), parseColor(0xCFCF6F),\n  parseColor(0xDFDF9F), parseColor(0xEFEFC7), parseColor(0xFFFFFF)   \n];\n\nexport default class DoomFire extends HTMLElement {\n  constructor() {\n    super();\n    this.flames = [];\n    this.width = 320;\n    this.height = 200;\n    this.active = true;\n\n    // Create a Canvas to draw the flames.\n    this.canvas = document.createElement('canvas');\n\n    // Set size.\n    this.canvas.width = this.width;\n    this.canvas.height = this.height;\n\n    // Make it fill the whole element.\n    this.canvas.style.width = '100%';\n    this.canvas.style.height = '100%';\n\n    // Initialise the flames.\n    for (let x = 0; x < this.width; x++) {\n      for (let y = 1; y < this.height; y++) {\n        this.setValue(x, y, 0);\n      }\n    }\n\n    for (let x = 0; x < this.width; x++) {\n      this.setValue(x, 0, 35);      \n    }        \n\n    const shadowRoot = this.attachShadow({mode: 'open'});\n    shadowRoot.appendChild(this.canvas);\n    this.ctx = this.canvas.getContext('2d');    \n    this.imageData = this.ctx.getImageData(0, 0, this.width, this.height);\n\n    // Initialise the canvas with black.\n    for (let i = 0; i < this.imageData.data.length; i++) {\n      this.imageData.data[i] = 0;\n      if (i % 4 == 3) this.imageData.data[i] = 255;\n    }\n     \n    this.addEventListener('click', () => {\n      this.toggle();\n    });\n  }\n\n  _postAt(x, y) {\n    return y * this.width + x;\n  }\n\n  setValue(x, y, value) {\n    let pos = this._postAt(x, y);\n    this.flames[pos] = value; \n  }\n\n  valueAt(x, y) {\n    let pos = this._postAt(x, y);\n    return this.flames[pos];\n  }\n\n  connectedCallback() {\n    window.requestAnimationFrame(this.update.bind(this));    \n  }  \n\n  update() {\n    for (let srcX = 0; srcX < this.width; srcX++) {\n      for (let srcY = 0; srcY < this.height - 1; srcY++) {\n        let rand = Math.round(Math.random() * 3.0) & 3;\n  \n        let srcColor = this.valueAt(srcX, srcY);\n        let dstColor = srcColor - (rand & 1);\n  \n        let dstX = srcX + rand - 2;\n        let dstY = srcY + 1;\n  \n        this.setValue(dstX, dstY, dstColor);\n  \n        let pos = ((this.height - srcY) * this.width + srcX) * 4;  \n        if (srcColor > 0) {\n          let color = HTML_COLOR_SCALE[srcColor];\n          this.imageData.data[pos] = color.r;\n          this.imageData.data[pos + 1] = color.g;\n          this.imageData.data[pos + 2] = color.b;\n          this.imageData.data[pos + 3] = 255;\n        } else {\n          this.imageData.data[pos] = 0;\n          this.imageData.data[pos + 1] = 0;\n          this.imageData.data[pos + 2] = 0;\n          this.imageData.data[pos + 3] = 255;        \n        }\n      }\n    }\n    this.ctx.putImageData(this.imageData, 0, 0);\n    window.requestAnimationFrame(this.update.bind(this));\n  }\n\n  toggle() {\n    if (this.active) {\n      for (let x = 0; x < this.width; x++) {\n        this.setValue(x, 0, 0);      \n      }    \n    } else {\n      for (let x = 0; x < this.width; x++) {\n        this.setValue(x, 0, 35);      \n      }    \n    }\n    this.active = !this.active;\n  }\n}\n\nif (!customElements.get('doom-fire')) {\n  customElements.define('doom-fire', DoomFire);\n}\n\nfunction parseColor(color) {\n  const b = color & 0xFF;\n  const g = color >> 8 & 0xFF;\n  const r = color >> 16 & 0xFF;\n  return {r, g, b}\n}\n"],"names":["HTML_COLOR_SCALE","parseColor","DoomFire","HTMLElement","[object Object]","super","this","flames","width","height","active","canvas","document","createElement","style","x","y","setValue","attachShadow","mode","appendChild","ctx","getContext","imageData","getImageData","i","data","length","addEventListener","toggle","value","pos","_postAt","window","requestAnimationFrame","update","bind","srcX","srcY","rand","Math","round","random","srcColor","valueAt","dstColor","dstX","dstY","color","r","g","b","putImageData","customElements","get","define"],"mappings":"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"}