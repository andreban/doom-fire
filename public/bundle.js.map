{"version":3,"file":"bundle.js","sources":["../src/doom-fire.mjs"],"sourcesContent":["\nexport default class DoomFire extends HTMLElement {\n  constructor() {\n    super();\n    this.active = true;\n\n    // Create a Canvas to draw the flames.\n    this.canvas = document.createElement('canvas');\n\n    // Set size.\n    this.canvas.width = this.width;\n    this.canvas.height = this.height;\n\n    // Make it fill the whole element.\n    this.canvas.style.width = '100%';\n    this.canvas.style.height = '100%';\n\n    const offscreenCanvas = this.canvas.transferControlToOffscreen();\n    offscreenCanvas.width = 320;\n    offscreenCanvas.height = 200;\n\n    this.worker = new Worker('doom-fire-worker.js');\n    this.worker.postMessage({msg: 'init', canvas: offscreenCanvas}, [offscreenCanvas]);\n\n    const shadowRoot = this.attachShadow({mode: 'open'});\n    shadowRoot.appendChild(this.canvas);\n     \n    this.addEventListener('click', () => {\n      this.toggle();\n    });\n  }\n\n  connectedCallback() {\n    // window.requestAnimationFrame(this.update.bind(this));    \n    this.worker.postMessage({msg: 'start'});\n  }  \n\n  update() {\n    for (let srcX = 0; srcX < this.width; srcX++) {\n      for (let srcY = 0; srcY < this.height - 1; srcY++) {\n        let rand = Math.round(Math.random() * 3.0) & 3;\n  \n        let srcColor = this.valueAt(srcX, srcY);\n        let dstColor = srcColor - (rand & 1);\n  \n        let dstX = srcX + rand - 2;\n        let dstY = srcY + 1;\n  \n        this.setValue(dstX, dstY, dstColor);\n  \n        let pos = ((this.height - srcY) * this.width + srcX) * 4;  \n        if (srcColor > 0) {\n          let color = HTML_COLOR_SCALE[srcColor];\n          this.imageData.data[pos] = color.r;\n          this.imageData.data[pos + 1] = color.g;\n          this.imageData.data[pos + 2] = color.b;\n          this.imageData.data[pos + 3] = 255;\n        } else {\n          this.imageData.data[pos] = 0;\n          this.imageData.data[pos + 1] = 0;\n          this.imageData.data[pos + 2] = 0;\n          this.imageData.data[pos + 3] = 255;        \n        }\n      }\n    }\n    this.ctx.putImageData(this.imageData, 0, 0);\n    window.requestAnimationFrame(this.update.bind(this));\n  }\n\n  toggle() {\n    if (this.active) {\n      for (let x = 0; x < this.width; x++) {\n        this.setValue(x, 0, 0);      \n      }    \n    } else {\n      for (let x = 0; x < this.width; x++) {\n        this.setValue(x, 0, 35);      \n      }    \n    }\n    this.active = !this.active;\n  }\n}\n\nif (!customElements.get('doom-fire')) {\n  customElements.define('doom-fire', DoomFire);\n}\n\n"],"names":["DoomFire","HTMLElement","[object Object]","super","this","active","canvas","document","createElement","width","height","style","offscreenCanvas","transferControlToOffscreen","worker","Worker","postMessage","msg","attachShadow","mode","appendChild","addEventListener","toggle","srcX","srcY","rand","Math","round","random","srcColor","valueAt","dstColor","dstX","dstY","setValue","pos","color","HTML_COLOR_SCALE","imageData","data","r","g","b","ctx","putImageData","window","requestAnimationFrame","update","bind","x","customElements","get","define"],"mappings":"yBACe,MAAMA,UAAiBC,YACpCC,cACEC,QACAC,KAAKC,QAAS,EAGdD,KAAKE,OAASC,SAASC,cAAc,UAGrCJ,KAAKE,OAAOG,MAAQL,KAAKK,MACzBL,KAAKE,OAAOI,OAASN,KAAKM,OAG1BN,KAAKE,OAAOK,MAAMF,MAAQ,OAC1BL,KAAKE,OAAOK,MAAMD,OAAS,OAE3B,MAAME,EAAkBR,KAAKE,OAAOO,6BACpCD,EAAgBH,MAAQ,IACxBG,EAAgBF,OAAS,IAEzBN,KAAKU,OAAS,IAAIC,OAAO,uBACzBX,KAAKU,OAAOE,YAAY,CAACC,IAAK,OAAQX,OAAQM,GAAkB,CAACA,IAE9CR,KAAKc,aAAa,CAACC,KAAM,SACjCC,YAAYhB,KAAKE,QAE5BF,KAAKiB,iBAAiB,QAAS,KAC7BjB,KAAKkB,WAITpB,oBAEEE,KAAKU,OAAOE,YAAY,CAACC,IAAK,UAGhCf,SACE,IAAK,IAAIqB,EAAO,EAAGA,EAAOnB,KAAKK,MAAOc,IACpC,IAAK,IAAIC,EAAO,EAAGA,EAAOpB,KAAKM,OAAS,EAAGc,IAAQ,CACjD,IAAIC,EAAyC,EAAlCC,KAAKC,MAAsB,EAAhBD,KAAKE,UAEvBC,EAAWzB,KAAK0B,QAAQP,EAAMC,GAC9BO,EAAWF,GAAmB,EAAPJ,GAEvBO,EAAOT,EAAOE,EAAO,EACrBQ,EAAOT,EAAO,EAElBpB,KAAK8B,SAASF,EAAMC,EAAMF,GAE1B,IAAII,EAAmD,IAA3C/B,KAAKM,OAASc,GAAQpB,KAAKK,MAAQc,GAC/C,GAAIM,EAAW,EAAG,CAChB,IAAIO,EAAQC,iBAAiBR,GAC7BzB,KAAKkC,UAAUC,KAAKJ,GAAOC,EAAMI,EACjCpC,KAAKkC,UAAUC,KAAKJ,EAAM,GAAKC,EAAMK,EACrCrC,KAAKkC,UAAUC,KAAKJ,EAAM,GAAKC,EAAMM,EACrCtC,KAAKkC,UAAUC,KAAKJ,EAAM,GAAK,SAE/B/B,KAAKkC,UAAUC,KAAKJ,GAAO,EAC3B/B,KAAKkC,UAAUC,KAAKJ,EAAM,GAAK,EAC/B/B,KAAKkC,UAAUC,KAAKJ,EAAM,GAAK,EAC/B/B,KAAKkC,UAAUC,KAAKJ,EAAM,GAAK,IAIrC/B,KAAKuC,IAAIC,aAAaxC,KAAKkC,UAAW,EAAG,GACzCO,OAAOC,sBAAsB1C,KAAK2C,OAAOC,KAAK5C,OAGhDF,SACE,GAAIE,KAAKC,OACP,IAAK,IAAI4C,EAAI,EAAGA,EAAI7C,KAAKK,MAAOwC,IAC9B7C,KAAK8B,SAASe,EAAG,EAAG,QAGtB,IAAK,IAAIA,EAAI,EAAGA,EAAI7C,KAAKK,MAAOwC,IAC9B7C,KAAK8B,SAASe,EAAG,EAAG,IAGxB7C,KAAKC,QAAUD,KAAKC,QAInB6C,eAAeC,IAAI,cACtBD,eAAeE,OAAO,YAAapD"}