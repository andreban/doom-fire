{"version":3,"file":"doom-fire-worker.js","sources":["../src/doom-fire-worker.js"],"sourcesContent":["const HTML_COLOR_SCALE = [\n  parseColor(0x070707), parseColor(0x1f0707), parseColor(0x2f0f07),\n  parseColor(0x470f07), parseColor(0x571707), parseColor(0x671f07),\n  parseColor(0x771f07), parseColor(0x8f2707), parseColor(0x9f2f07),\n  parseColor(0xaf3f07), parseColor(0xbf4707), parseColor(0xc74707),\n  parseColor(0xDF4F07), parseColor(0xDF5707), parseColor(0xDF5707),\n  parseColor(0xD75F07), parseColor(0xD7670F), parseColor(0xcf6f0f),\n  parseColor(0xcf770f), parseColor(0xcf7f0f), parseColor(0xCF8717),\n  parseColor(0xC78717), parseColor(0xC78F17), parseColor(0xC7971F),\n  parseColor(0xBF9F1F), parseColor(0xBF9F1F), parseColor(0xBFA727),\n  parseColor(0xBFA727), parseColor(0xBFAF2F), parseColor(0xB7AF2F),\n  parseColor(0xB7B72F), parseColor(0xB7B737), parseColor(0xCFCF6F),\n  parseColor(0xDFDF9F), parseColor(0xEFEFC7), parseColor(0xFFFFFF)   \n];\nconst flames = [];\nconst width = 320;\nconst height = 200;\n\nlet canvas;\nlet ctx;\nlet imageData;\n\nfunction parseColor(color) {\n  const b = color & 0xFF;\n  const g = color >> 8 & 0xFF;\n  const r = color >> 16 & 0xFF;\n  return {r, g, b}\n}\n\nfunction posAt(x, y) {\n  return y * width + x;\n}\n\nfunction setValue(x, y, value) {\n  let pos = posAt(x, y);\n  flames[pos] = value; \n}\n\nfunction valueAt(x, y) {\n  let pos = posAt(x, y);\n  return flames[pos];\n}\n\nfunction init() {\n    // Initialise the flames.\n    for (let x = 0; x < width; x++) {\n      for (let y = 1; y < height; y++) {\n        setValue(x, y, 0);\n      }\n    }\n\n    for (let x = 0; x < width; x++) {\n      setValue(x, 0, 35);      \n    }\n}\n\nfunction update() {\n  for (let srcX = 0; srcX < width; srcX++) {\n    for (let srcY = 0; srcY < height - 1; srcY++) {\n      let rand = Math.round(Math.random() * 3.0) & 3;\n\n      let srcColor = valueAt(srcX, srcY);\n      let dstColor = srcColor - (rand & 1);\n\n      let dstX = srcX + rand - 2;\n      let dstY = srcY + 1;\n\n      setValue(dstX, dstY, dstColor);\n\n      let pos = ((height - srcY) * width + srcX) * 4;  \n      if (srcColor > 0) {\n        let color = HTML_COLOR_SCALE[srcColor];\n        imageData.data[pos] = color.r;\n        imageData.data[pos + 1] = color.g;\n        imageData.data[pos + 2] = color.b;\n        imageData.data[pos + 3] = 255;\n      } else {\n        imageData.data[pos] = 0;\n        imageData.data[pos + 1] = 0;\n        imageData.data[pos + 2] = 0;\n        imageData.data[pos + 3] = 255;        \n      }\n    }\n  }\n\n  ctx.putImageData(imageData, 0, 0);  \n  self.requestAnimationFrame(update);\n}\n\nself.onmessage = function(ev) {\n  if(ev.data.msg === 'init') {\n    canvas = ev.data.canvas;\n    ctx = canvas.getContext('2d');\n    init();\n  }\n\n  if (ev.data.msg === 'start') {\n    console.log('start');\n    imageData = ctx.getImageData(0, 0, width, height);    \n    // Initialise the canvas with black.\n    for (let i = 0; i < imageData.data.length; i++) {\n      imageData.data[i] = 128;\n      if (i % 4 == 3) imageData.data[i] = 255;\n    }\n    update();\n  }\n}"],"names":["HTML_COLOR_SCALE","parseColor","flames","width","height","canvas","ctx","imageData","color","r","g","b","posAt","x","y","setValue","value","pos","valueAt","update","srcX","srcY","rand","Math","round","random","srcColor","data","putImageData","self","requestAnimationFrame","onmessage","ev","msg","getContext","init","console","log","getImageData","i","length"],"mappings":"yBAAA,MAAMA,EAAmB,CACvBC,EAAW,QAAWA,EAAW,SAAWA,EAAW,SACvDA,EAAW,SAAWA,EAAW,SAAWA,EAAW,SACvDA,EAAW,SAAWA,EAAW,SAAWA,EAAW,UACvDA,EAAW,UAAWA,EAAW,UAAWA,EAAW,UACvDA,EAAW,UAAWA,EAAW,UAAWA,EAAW,UACvDA,EAAW,UAAWA,EAAW,UAAWA,EAAW,UACvDA,EAAW,UAAWA,EAAW,UAAWA,EAAW,UACvDA,EAAW,UAAWA,EAAW,UAAWA,EAAW,UACvDA,EAAW,UAAWA,EAAW,UAAWA,EAAW,UACvDA,EAAW,UAAWA,EAAW,UAAWA,EAAW,UACvDA,EAAW,UAAWA,EAAW,UAAWA,EAAW,UACvDA,EAAW,UAAWA,EAAW,UAAWA,EAAW,WAEnDC,EAAS,GACTC,EAAQ,IACRC,EAAS,IAEf,IAAIC,EACAC,EACAC,EAEJ,SAASN,EAAWO,GAIlB,MAAO,CAACC,EADED,GAAS,GAAK,IACbE,EAFDF,GAAS,EAAI,IAETG,EAHI,IAARH,GAMZ,SAASI,EAAMC,EAAGC,GAChB,OAAOA,EAAIX,EAAQU,EAGrB,SAASE,EAASF,EAAGC,EAAGE,GACtB,IAAIC,EAAML,EAAMC,EAAGC,GACnBZ,EAAOe,GAAOD,EAGhB,SAASE,EAAQL,EAAGC,GAClB,IAAIG,EAAML,EAAMC,EAAGC,GACnB,OAAOZ,EAAOe,GAgBhB,SAASE,IACP,IAAK,IAAIC,EAAO,EAAGA,EAAOjB,EAAOiB,IAC/B,IAAK,IAAIC,EAAO,EAAGA,EAAOjB,EAAS,EAAGiB,IAAQ,CAC5C,IAAIC,EAAyC,EAAlCC,KAAKC,MAAsB,EAAhBD,KAAKE,UAEvBC,EAAWR,EAAQE,EAAMC,GAM7BN,EAHWK,EAAOE,EAAO,EACdD,EAAO,EAHHK,GAAmB,EAAPJ,IAO3B,IAAIL,EAAyC,IAAjCb,EAASiB,GAAQlB,EAAQiB,GACrC,GAAIM,EAAW,EAAG,CAChB,IAAIlB,EAAQR,EAAiB0B,GAC7BnB,EAAUoB,KAAKV,GAAOT,EAAMC,EAC5BF,EAAUoB,KAAKV,EAAM,GAAKT,EAAME,EAChCH,EAAUoB,KAAKV,EAAM,GAAKT,EAAMG,EAChCJ,EAAUoB,KAAKV,EAAM,GAAK,SAE1BV,EAAUoB,KAAKV,GAAO,EACtBV,EAAUoB,KAAKV,EAAM,GAAK,EAC1BV,EAAUoB,KAAKV,EAAM,GAAK,EAC1BV,EAAUoB,KAAKV,EAAM,GAAK,IAKhCX,EAAIsB,aAAarB,EAAW,EAAG,GAC/BsB,KAAKC,sBAAsBX,GAG7BU,KAAKE,UAAY,SAASC,GAOxB,GANmB,SAAhBA,EAAGL,KAAKM,MACT5B,EAAS2B,EAAGL,KAAKtB,OACjBC,EAAMD,EAAO6B,WAAW,MAjD5B,WAEI,IAAK,IAAIrB,EAAI,EAAGA,EAAIV,EAAOU,IACzB,IAAK,IAAIC,EAAI,EAAGA,EAAIV,EAAQU,IAC1BC,EAASF,EAAGC,EAAG,GAInB,IAAK,IAAID,EAAI,EAAGA,EAAIV,EAAOU,IACzBE,EAASF,EAAG,EAAG,IAyCjBsB,IAGkB,UAAhBH,EAAGL,KAAKM,IAAiB,CAC3BG,QAAQC,IAAI,SACZ9B,EAAYD,EAAIgC,aAAa,EAAG,EAAGnC,EAAOC,GAE1C,IAAK,IAAImC,EAAI,EAAGA,EAAIhC,EAAUoB,KAAKa,OAAQD,IACzChC,EAAUoB,KAAKY,GAAK,IAChBA,EAAI,GAAK,IAAGhC,EAAUoB,KAAKY,GAAK,KAEtCpB"}